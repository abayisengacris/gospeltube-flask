<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - Manage Videos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f5f6fa; padding:30px; color:#333; }
h1 { margin-bottom:20px; color:#007bff; }

.nav { margin-bottom:20px; }
.nav a { text-decoration:none; color:#007bff; font-weight:bold; margin-right:10px; }

.msg { padding:10px 15px; border-radius:5px; margin-bottom:15px; }
.success { background:#d4edda; color:#155724; }
.danger { background:#f8d7da; color:#721c24; }
.warning { background:#fff3cd; color:#856404; }
.info { background:#cce5ff; color:#004085; }

form { background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.08); margin-bottom:30px; }
form label { display:block; margin-top:10px; font-weight:bold; }
form input, form select, form textarea { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
form button { margin-top:15px; padding:10px 15px; border:none; border-radius:5px; background:#007bff; color:white; cursor:pointer; }
form button:hover { background:#0056b3; }

table {
    width:100%;
    border-collapse: collapse;
    background:#fff;
    border-radius:8px;
    overflow:hidden;
    box-shadow:0 0 10px rgba(0,0,0,0.08);
}
th, td { padding:12px 15px; text-align:left; border-bottom:1px solid #eee; }
th { background:#007bff; color:white; }
tr:hover { background:#f1f1f1; }

.actions button, .actions a {
    padding:6px 10px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-size:13px;
    margin-right:5px;
    text-decoration:none;
}
.edit { background:#ffc107; color:#000; }
.edit:hover { background:#e0a800; }
.delete { background:#dc3545; color:white; }
.delete:hover { background:#c82333; }

@media(max-width:768px) {
    table, thead, tbody, th, td, tr { display:block; }
    th { position: absolute; top: -9999px; left: -9999px; }
    tr { margin-bottom: 15px; border-bottom: 2px solid #ddd; }
    td { border:none; position: relative; padding-left: 50%; }
    td:before { 
        position: absolute; top:12px; left:15px; width:45%; padding-right:10px; white-space: nowrap;
        font-weight:bold; 
    }
    td:nth-of-type(1):before { content: "Title"; }
    td:nth-of-type(2):before { content: "Category"; }
    td:nth-of-type(3):before { content: "Views"; }
    td:nth-of-type(4):before { content: "Date Added"; }
    td:nth-of-type(5):before { content: "Actions"; }
}
</style>
</head>
<body>

<h1>Manage Videos</h1>

<div class="nav">
    <a href="{{ url_for('manage_videos') }}">üì∫ Videos</a>
    <a href="{{ url_for('manage_categories') }}">üìÅ Categories</a>
    <a href="{{ url_for('logout') }}">Logout</a>
</div>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="msg {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Add New Video Form -->
<h2>Add New Video</h2>
<form method="POST" action="{{ url_for('add_video') }}">
    <label>Title</label>
    <input type="text" name="title" placeholder="Video Title" required>

    <label>Description</label>
    <textarea name="description" placeholder="Video Description"></textarea>

    <label>Category</label>
    <select name="category_id">
        <option value="">-- Select Category --</option>
        {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
        {% endfor %}
    </select>

    <label>YouTube Link</label>
    <input type="text" name="youtube_link" placeholder="YouTube Video Link" required>

    <label>Google Drive Link (Translated/Agasobanuye)</label>
    <input type="text" name="drive_link" placeholder="Google Drive Link">

    <label>MediaFire Download Link</label>
    <input type="text" name="mediafire_link" placeholder="MediaFire Link">

    <button type="submit">Add Video</button>
</form>
<!-- ====================== Create New User ====================== -->
<div class="card mt-4">
    <div class="card-header bg-primary text-white">
        Create New User (Uploader)
    </div>
    <div class="card-body">
<form method="POST" action="{{ url_for('create_user') }}">
    <div class="mb-3">
        <label for="username">Username</label>
        <input type="text" id="username" name="username" required class="form-control">
    </div>

    <div class="mb-3">
        <label for="email">Email</label>
        <!-- ‚úÖ Add this input -->
        <input type="email" id="email" name="email" required class="form-control">
    </div>

    <div class="mb-3">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required class="form-control">
    </div>

    <div class="mb-3">
        <label for="role">Role</label>
        <select id="role" name="role" class="form-select">
            <option value="uploader">Uploader</option>
            <option value="admin">Admin</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Create User</button>
</form>
    </div>
</div>
<!-- Video List -->
<h2>All Videos</h2>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Views</th>
            <th>Date Added</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
{% for v in videos %}
<tr>
    <td>{{ v.title }}</td>
    <td>{{ v.category.name if v.category else "None" }}</td>
    <td>{{ v.views }}</td>
    <td>{{ v.date_added.strftime('%Y-%m-%d') }}</td>
    <td class="actions">
        <!-- Edit button (everyone sees) -->
        <a class="edit" href="{{ url_for('edit_video', video_id=v.id) }}">Edit</a>

        <!-- Delete button (admin only) -->
        {% if session.role == "admin" %}
        <form method="POST" action="{{ url_for('delete_video', video_id=v.id) }}" style="display:inline;" onsubmit="return confirm('Delete this video?');">
            <button type="submit" class="delete">Delete</button>
        </form>
        {% endif %}
    </td>
</tr>
{% else %}
<tr>
    <td colspan="5">No videos found.</td>
</tr>
{% endfor %}
    </tbody>
</table>

</body>
</html>
